<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Escuela SabÃ¡tica</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- CABECERA CON LOGO -->
  <header class="top-bar">
    <div class="logo-area">
      <img src="logo.png" alt="Logo Escuela" class="logo">
      <h1 class="titulo-escuela">Escuela SabÃ¡tica</h1>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="container">
    <h2>Ingreso Escuela SabÃ¡tica</h2>

    <!-- BotÃ³n para solicitar nueva clase -->
    <div style="text-align: right; margin-bottom: 12px;">
      <button onclick="abrirFormularioClase()" class="solicitar-clase">ğŸ“‹ Registrar Nueva Clase</button>
    </div>

    <!-- Modal para ingresar el cÃ³digo de invitaciÃ³n -->
    <div id="modalCodigoInvitacion" class="modal oculto">
      <div class="modal-content">
        <h3>Introducir CÃ³digo de InvitaciÃ³n</h3>
        <input type="text" id="codigoInvitacion" placeholder="CÃ³digo de invitaciÃ³n">
        <button onclick="verificarCodigo()">Verificar</button>
        <button onclick="cerrarModalCodigo()">Cerrar</button>
      </div>
    </div>

    <!-- Modal para registrar una nueva clase -->
    <div id="modalRegistrarClase" class="modal oculto">
      <div class="modal-content">
        <h3>Nueva Clase</h3>
        <label>Nombre Completo del Maestro:</label>
        <input type="text" id="nombreCompletoMaestro" placeholder="Ej: Juan PÃ©rez">
        <label>PaÃ­s:</label>
        <input type="text" id="paisMaestro" placeholder="Ej: Bolivia">
        <button onclick="registrarNuevaClase()">Registrar Clase</button>
        <button onclick="cerrarFormularioClase()">Cerrar</button>
      </div>
    </div>

    <!-- Modal para mostrar el mensaje de registro exitoso -->
    <div id="modalMensaje" class="modal oculto">
      <div class="modal-content">
        <h3>Registro Exitoso</h3>
        <p id="mensajeExito"></p>
        <button onclick="cerrarModalMensaje()">Cerrar</button>
      </div>
    </div>

    <!-- LOGIN MAESTRO -->
    <div class="bloque fade-in">
      <h3>ğŸ‘¨â€ğŸ« Login Maestro</h3>
      <div class="contenido">
        <div class="input-icon">
          <span class="icono">ğŸ«</span>
          <input type="text" id="claseMaestro" placeholder="ID de Clase (Ej: clase1)">
        </div>
        <div class="input-icon">
          <span class="icono">ğŸ”’</span>
          <input type="password" id="claveMaestro" placeholder="ContraseÃ±a">
        </div>
        <button onclick="loginMaestro()">Entrar</button>
      </div>
    </div>

    <!-- LOGIN ALUMNO -->
    <div class="bloque fade-in">
      <h3>ğŸ‘©â€ğŸ“ Login Alumno</h3>
      <div class="contenido">
        <div class="input-icon">
          <span class="icono">ğŸ«</span>
          <input type="text" id="claseAlumno" placeholder="Clase (Ej: KM6_2)">
        </div>
        <div class="input-icon">
          <span class="icono">ğŸ†”</span>
          <input type="text" id="alumno" placeholder="ID del Alumno (Ej: Jos123)">
        </div>
        <button onclick="loginAlumno()">Entrar</button>
      </div>
    </div>

    <!-- CONTENEDOR DE ALERTAS -->
    <div id="toast-container"></div>

  </div>

  <!-- PIE DE PÃGINA -->
  <footer class="footer" style="text-align: center; margin-top: 40px; font-size: 0.9rem; color: #777;">
    <p>Â© Todos los derechos reservados â€” Desarrollado por el Ministerio 
      <a href="https://elviene.org" target="_blank" style="color: #2980b9;">Elviene.org</a>
    </p>
  </footer>

  <!-- SCRIPTS -->
  <script src="conexion.js"></script>
  <script src="login.js"></script>

  <!-- TOGGLE de tarjetas -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".bloque h3").forEach(titulo => {
        titulo.addEventListener("click", () => {
          const contenido = titulo.nextElementSibling;
          contenido.style.display = contenido.style.display === "block" ? "none" : "block";
        });
      });
    });

    // Funciones para el manejo del cÃ³digo de invitaciÃ³n
    function abrirFormularioClase() {
      document.getElementById("modalCodigoInvitacion").classList.remove("oculto");
    }

    function cerrarModalCodigo() {
      document.getElementById("modalCodigoInvitacion").classList.add("oculto");
    }

    function verificarCodigo() {
      const codigoIngresado = document.getElementById("codigoInvitacion").value.trim();

      fetch(`${URL}?accion=getCodigo`)
        .then(res => res.text())
        .then(codigoValido => {
          if (codigoIngresado === codigoValido) {
            mostrarToast("âœ… CÃ³digo correcto", "success");
            cerrarModalCodigo();
            abrirModalRegistro();
          } else {
            mostrarToast("âŒ CÃ³digo incorrecto", "error");
          }
        })
        .catch(() => {
          mostrarToast("âŒ Error al verificar el cÃ³digo", "error");
        });
    }

    function abrirModalRegistro() {
      document.getElementById("modalRegistrarClase").classList.remove("oculto");
    }

    function cerrarFormularioClase() {
      document.getElementById("modalRegistrarClase").classList.add("oculto");
    }

    function cerrarModalMensaje() {
      document.getElementById("modalMensaje").classList.add("oculto");
    }
  </script>

</body>
</html>
